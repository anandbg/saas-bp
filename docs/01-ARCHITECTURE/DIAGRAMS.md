# System Architecture Diagrams

## ğŸ“ Visual Documentation

This document provides ASCII-based architectural diagrams for the Radiology Reporting App. These diagrams complement the Blueprint and Technical Design documents.

---

## ğŸ—ï¸ High-Level System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT LAYER                                    â”‚
â”‚                         (Browser / Mobile Device)                            â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Next.js 14+ Frontend (React 18)                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Dashboard  â”‚  â”‚   Generate   â”‚  â”‚   Reports    â”‚  â”‚ Templates â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     Page     â”‚  â”‚    Report    â”‚  â”‚     Page     â”‚  â”‚   Page    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              OpenAI ChatKit Widget (Embedded)                  â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                   UI Components Layer                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Audio Recorder/Uploader  â€¢ Template Selector               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Report Form/Preview      â€¢ Search Panel                     â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTPS / WebSocket
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          APPLICATION LAYER                                   â”‚
â”‚                      (Vercel Edge Network / Node.js)                         â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Next.js Server Components & API Routes              â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚    Auth     â”‚  â”‚Transcriptionâ”‚  â”‚   Report    â”‚  â”‚   Template   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   Routes    â”‚  â”‚   Service   â”‚  â”‚  Generator  â”‚  â”‚   Service    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Search    â”‚  â”‚   Export    â”‚  â”‚  Analytics  â”‚  â”‚   Webhook    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚  â”‚   Tracker   â”‚  â”‚   Handler    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         Business Logic Layer                           â”‚ â”‚
â”‚  â”‚  â€¢ Spoken Punctuation Converter  â€¢ Contradiction Cleaner              â”‚ â”‚
â”‚  â”‚  â€¢ Prompt Builder                â€¢ Model Fallback Handler             â”‚ â”‚
â”‚  â”‚  â€¢ Template Integration          â€¢ Validation & Error Handling        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
    â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase â”‚ â”‚ Outseta â”‚ â”‚  OpenAI   â”‚ â”‚ Deepgram â”‚ â”‚  Google  â”‚ â”‚Radiopae- â”‚
â”‚PostgreSQLâ”‚ â”‚Auth+CRM â”‚ â”‚   API     â”‚ â”‚  (Opt)   â”‚ â”‚Custom SE â”‚ â”‚ dia API  â”‚
â”‚ Database â”‚ â”‚ Billing â”‚ â”‚  (GPT-5,  â”‚ â”‚Transcrip.â”‚ â”‚ (Search) â”‚ â”‚(Medical) â”‚
â”‚ Storage  â”‚ â”‚ Users   â”‚ â”‚O3,Whisper)â”‚ â”‚          â”‚ â”‚          â”‚ â”‚ Search   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ ChatKit   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   External Integrations    â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ PubMed E-utilities       â”‚
                    â”‚ â€¢ Sentry (Error Tracking)  â”‚
                    â”‚ â€¢ Vercel Analytics         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### 1. User Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Browser â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Click "Login"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login Page      â”‚
â”‚ /login          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Redirect to Outseta
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Outseta Hosted Login        â”‚
â”‚  (outseta.com/auth/login)       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. User enters credentials
     â”‚ 4. Outseta validates
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Outseta Authorization Server   â”‚
â”‚  Generates: authorization_code  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. Redirect back with code
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /api/auth/callback            â”‚
â”‚   (Next.js API Route)           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. Exchange code for token
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Outseta Token Endpoint     â”‚
â”‚  Returns: access_token,         â”‚
â”‚           refresh_token         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 7. Verify token & get user
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Outseta Profile Endpoint     â”‚
â”‚  Returns: User profile data     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 8. Create/Update user
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Supabase Database           â”‚
â”‚  Upsert user record             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 9. Set session cookie
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response with Set-Cookie      â”‚
â”‚   session_token=xxx             â”‚
â”‚   HttpOnly, Secure              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 10. Redirect to /dashboard
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Dashboard Page             â”‚
â”‚   (User authenticated)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Report Generation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Fill report form
     â”‚    (scan type, findings, template)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Report Generation Form        â”‚
â”‚   /generate                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Submit form data
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POST /api/generate            â”‚
â”‚   Validates: Zod schema         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. Check auth & subscription
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth Middleware               â”‚
â”‚   Verifies: session_token       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. Load template (if ID provided)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Template Service              â”‚
â”‚   Query: Supabase               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. Process findings
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Spoken Punctuation Converter  â”‚
â”‚   Transform: "full stop" â†’ "."  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. Integrate with template
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Contradiction Cleaner         â”‚
â”‚   Remove: conflicting normals   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 7. Build prompt
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Prompt Builder                â”‚
â”‚   Load: report_prompt.txt       â”‚
â”‚   Insert: findings, template    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 8. Call AI model
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OpenAI API                    â”‚
â”‚   Model: GPT-5 or O3            â”‚
â”‚   (with fallback)               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 9. If primary fails
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Model Fallback Handler        â”‚
â”‚   Try: gpt-4o or gpt-4o-mini    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 10. Parse & validate response
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Response Validator            â”‚
â”‚   Check: JSON structure         â”‚
â”‚   Verify: no contradictions     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 11. Save to database
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase Database             â”‚
â”‚   Insert: reports table         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 12. Return report
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JSON Response                 â”‚
â”‚   {report: {...},               â”‚
â”‚    metadata: {...}}             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 13. Display to user
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Report Preview Component      â”‚
â”‚   Render: Formatted report      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Real-Time Transcription Flow (WebSocket)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. Click "Start Recording"
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Audio Recorder Component      â”‚
â”‚   Initialize: MediaRecorder     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 2. Request microphone access
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser Audio API             â”‚
â”‚   getUserMedia()                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 3. Establish WebSocket
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WS /api/transcribe/ws         â”‚
â”‚   Upgrade: HTTP â†’ WebSocket     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 4. Start recording
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MediaRecorder                 â”‚
â”‚   Capture: Audio chunks         â”‚
â”‚   Format: WebM / Opus           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 5. Stream audio chunks
     â”‚    (every ~250ms)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Connection          â”‚
â”‚   Send: Binary audio data       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 6. Receive chunks
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Handler             â”‚
â”‚   Buffer: Audio data            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 7. Forward to Whisper
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OpenAI Whisper API            â”‚
â”‚   Model: whisper-1              â”‚
â”‚   Stream: Yes                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 8. Return transcript segments
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Handler             â”‚
â”‚   Process: Segments             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 9. Send to client
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Connection          â”‚
â”‚   Message: {                    â”‚
â”‚     type: 'transcript_segment'  â”‚
â”‚     text: '...',                â”‚
â”‚     is_final: false             â”‚
â”‚   }                             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 10. Update UI
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Transcription Display         â”‚
â”‚   Append: New text              â”‚
â”‚   Highlight: Current segment    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 11. Stop recording
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MediaRecorder.stop()          â”‚
â”‚   Send: 'stop' message          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 12. Finalize transcript
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket Handler             â”‚
â”‚   Apply: Spoken punctuation     â”‚
â”‚   Send: Complete transcript     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 13. Display final
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Findings Input Field          â”‚
â”‚   Insert: Full transcript       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Schema Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATABASE SCHEMA                                   â”‚
â”‚                        (Supabase PostgreSQL 15+)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        users            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id UUID PK              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ email TEXT UNIQUE       â”‚         â”‚
â”‚ name TEXT               â”‚         â”‚
â”‚ outseta_id TEXT UNIQUE  â”‚         â”‚
â”‚ avatar_url TEXT         â”‚         â”‚
â”‚ preferences JSONB       â”‚         â”‚
â”‚ created_at TIMESTAMP    â”‚         â”‚
â”‚ updated_at TIMESTAMP    â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                    â”‚ FK user_id
                                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                     â”‚                     â”‚
              â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      templates        â”‚ â”‚      reports       â”‚ â”‚  audio_files      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id UUID PK            â”‚ â”‚ id UUID PK         â”‚ â”‚ id UUID PK        â”‚
â”‚ user_id UUID FK       â”‚ â”‚ user_id UUID FK    â”‚ â”‚ user_id UUID FK   â”‚
â”‚ name TEXT             â”‚ â”‚ template_id UUID FKâ”œâ”€â–ºâ”‚ file_path TEXT    â”‚
â”‚ content TEXT          â”‚ â”‚ scan_type TEXT     â”‚ â”‚ file_name TEXT    â”‚
â”‚ description TEXT      â”‚ â”‚ clinical_hist TEXT â”‚ â”‚ mime_type TEXT    â”‚
â”‚ modality TEXT         â”‚ â”‚ findings TEXT      â”‚ â”‚ size_bytes BIGINT â”‚
â”‚ body_part TEXT        â”‚ â”‚ comparison TEXT    â”‚ â”‚ duration_sec DEC  â”‚
â”‚ tags TEXT[]           â”‚ â”‚ mode TEXT          â”‚ â”‚ created_at TS     â”‚
â”‚ is_default BOOLEAN    â”‚ â”‚ technique TEXT     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ version INTEGER       â”‚ â”‚ report_findings TX â”‚           â”‚
â”‚ created_at TIMESTAMP  â”‚ â”‚ impression TEXT    â”‚           â”‚ FK audio_file_id
â”‚ updated_at TIMESTAMP  â”‚ â”‚ clinical_adv TEXT  â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ questions TEXT[]   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ differential JSONB â”‚ â”‚  transcriptions   â”‚
                          â”‚ generation_time INTâ”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ model_used TEXT    â”‚ â”‚ id UUID PK        â”‚
                          â”‚ tokens_used INT    â”‚ â”‚ user_id UUID FK   â”‚
                          â”‚ cost_usd DECIMAL   â”‚ â”‚ audio_file_id FK  â”‚
                          â”‚ status TEXT        â”‚ â”‚ transcript TEXT   â”‚
                          â”‚ created_at TS      â”‚ â”‚ model_used TEXT   â”‚
                          â”‚ updated_at TS      â”‚ â”‚ confidence DEC    â”‚
                          â”‚ finalized_at TS    â”‚ â”‚ duration_ms INT   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ language TEXT     â”‚
                                                 â”‚ created_at TS     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    subscriptions        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id UUID PK              â”‚
â”‚ user_id UUID FK         â”œâ”€â”€â”€â”€â”
â”‚ outseta_id TEXT UNIQUE  â”‚    â”‚ FK user_id
â”‚ plan_name TEXT          â”‚    â”‚
â”‚ status TEXT             â”‚    â””â”€â”€â”€â”€â”€â”€â”
â”‚ current_period_start TS â”‚           â”‚
â”‚ current_period_end TS   â”‚           â”‚
â”‚ cancel_at TIMESTAMP     â”‚           â”‚
â”‚ created_at TIMESTAMP    â”‚           â”‚
â”‚ updated_at TIMESTAMP    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                      â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  (back to users)     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INDEXES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€
users:
  â€¢ idx_users_email (email)
  â€¢ idx_users_outseta_id (outseta_id)

templates:
  â€¢ idx_templates_user_id (user_id)
  â€¢ idx_templates_modality (modality)
  â€¢ idx_templates_body_part (body_part)
  â€¢ idx_templates_tags (tags) GIN

reports:
  â€¢ idx_reports_user_id (user_id)
  â€¢ idx_reports_template_id (template_id)
  â€¢ idx_reports_scan_type (scan_type)
  â€¢ idx_reports_status (status)
  â€¢ idx_reports_created_at (created_at DESC)
  â€¢ idx_reports_user_created (user_id, created_at DESC)

audio_files:
  â€¢ idx_audio_files_user_id (user_id)
  â€¢ idx_audio_files_created_at (created_at DESC)

transcriptions:
  â€¢ idx_transcriptions_user_id (user_id)
  â€¢ idx_transcriptions_audio_file_id (audio_file_id)

subscriptions:
  â€¢ idx_subscriptions_user_id (user_id)
  â€¢ idx_subscriptions_outseta_id (outseta_id)
  â€¢ idx_subscriptions_status (status)
```

---

## ğŸ”Œ Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COMPONENT HIERARCHY                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

App (Root Layout)
â”‚
â”œâ”€â”€ Providers
â”‚   â”œâ”€â”€ AuthProvider
â”‚   â”‚   â””â”€â”€ Context: { user, login, logout, isAuthenticated }
â”‚   â”œâ”€â”€ ThemeProvider
â”‚   â”‚   â””â”€â”€ Context: { theme, setTheme }
â”‚   â””â”€â”€ ToastProvider
â”‚       â””â”€â”€ Context: { toast, dismiss }
â”‚
â”œâ”€â”€ Layout (Dashboard Layout)
â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”œâ”€â”€ Logo
â”‚   â”‚   â”œâ”€â”€ Navigation
â”‚   â”‚   â”‚   â”œâ”€â”€ NavLink (Dashboard)
â”‚   â”‚   â”‚   â”œâ”€â”€ NavLink (Generate)
â”‚   â”‚   â”‚   â”œâ”€â”€ NavLink (Reports)
â”‚   â”‚   â”‚   â””â”€â”€ NavLink (Templates)
â”‚   â”‚   â””â”€â”€ UserMenu
â”‚   â”‚       â”œâ”€â”€ Avatar
â”‚   â”‚       â”œâ”€â”€ Dropdown
â”‚   â”‚       â”‚   â”œâ”€â”€ MenuItem (Settings)
â”‚   â”‚       â”‚   â”œâ”€â”€ MenuItem (Billing)
â”‚   â”‚       â”‚   â””â”€â”€ MenuItem (Logout)
â”‚   â”‚       â””â”€â”€ SubscriptionBadge
â”‚   â”‚
â”‚   â”œâ”€â”€ Sidebar (Optional)
â”‚   â”‚   â”œâ”€â”€ QuickActions
â”‚   â”‚   â”‚   â”œâ”€â”€ Button (New Report)
â”‚   â”‚   â”‚   â””â”€â”€ Button (New Template)
â”‚   â”‚   â””â”€â”€ RecentReports
â”‚   â”‚       â””â”€â”€ ReportCard[] (max 5)
â”‚   â”‚
â”‚   â””â”€â”€ Main
â”‚       â””â”€â”€ {children} (Page content)
â”‚
â””â”€â”€ Pages
    â”‚
    â”œâ”€â”€ DashboardPage (/)
    â”‚   â”œâ”€â”€ StatsCards
    â”‚   â”‚   â”œâ”€â”€ Card (Total Reports)
    â”‚   â”‚   â”œâ”€â”€ Card (This Month)
    â”‚   â”‚   â””â”€â”€ Card (Templates)
    â”‚   â”œâ”€â”€ RecentActivity
    â”‚   â”‚   â””â”€â”€ ActivityItem[]
    â”‚   â””â”€â”€ QuickStart
    â”‚       â””â”€â”€ ActionButton[]
    â”‚
    â”œâ”€â”€ GeneratePage (/generate)
    â”‚   â”œâ”€â”€ ReportForm
    â”‚   â”‚   â”œâ”€â”€ ScanTypeSelector
    â”‚   â”‚   â”‚   â””â”€â”€ Select (CT, MRI, X-Ray, etc.)
    â”‚   â”‚   â”œâ”€â”€ Input (Clinical History)
    â”‚   â”‚   â”œâ”€â”€ FindingsInput
    â”‚   â”‚   â”‚   â”œâ”€â”€ Textarea (Manual input)
    â”‚   â”‚   â”‚   â”œâ”€â”€ AudioRecorder
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RecordButton
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AudioVisualizer
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Timer
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ StopButton
    â”‚   â”‚   â”‚   â”œâ”€â”€ AudioUploader
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dropzone
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileList
    â”‚   â”‚   â”‚   â””â”€â”€ TranscriptionDisplay
    â”‚   â”‚   â”‚       â”œâ”€â”€ LiveText (streaming)
    â”‚   â”‚   â”‚       â””â”€â”€ ConfidenceIndicator
    â”‚   â”‚   â”œâ”€â”€ Input (Comparison)
    â”‚   â”‚   â”œâ”€â”€ TemplateSelector
    â”‚   â”‚   â”‚   â”œâ”€â”€ SearchInput
    â”‚   â”‚   â”‚   â”œâ”€â”€ FilterButtons
    â”‚   â”‚   â”‚   â””â”€â”€ TemplateGrid
    â”‚   â”‚   â”‚       â””â”€â”€ TemplateCard[]
    â”‚   â”‚   â””â”€â”€ GenerationOptions
    â”‚   â”‚       â”œâ”€â”€ RadioGroup (espresso/slow_brewed)
    â”‚   â”‚       â”œâ”€â”€ Checkbox (Include advice)
    â”‚   â”‚       â”œâ”€â”€ Checkbox (Include questions)
    â”‚   â”‚       â””â”€â”€ Checkbox (Include differential)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ChatKitWidget (Floating)
    â”‚   â”‚   â””â”€â”€ ChatKitSDK
    â”‚   â”‚       â”œâ”€â”€ ChatMessages
    â”‚   â”‚       â”œâ”€â”€ InputArea
    â”‚   â”‚       â””â”€â”€ CustomActions
    â”‚   â”‚
    â”‚   â””â”€â”€ ReportPreview
    â”‚       â”œâ”€â”€ LoadingState (during generation)
    â”‚       â”œâ”€â”€ ErrorState (if failed)
    â”‚       â””â”€â”€ ReportDisplay
    â”‚           â”œâ”€â”€ Section (Technique)
    â”‚           â”œâ”€â”€ Section (Comparison)
    â”‚           â”œâ”€â”€ Section (Findings)
    â”‚           â”œâ”€â”€ Section (Impression)
    â”‚           â”œâ”€â”€ Section (Clinical Advice)
    â”‚           â”œâ”€â”€ Section (Questions)
    â”‚           â”œâ”€â”€ Section (Differential Diagnosis)
    â”‚           â””â”€â”€ Actions
    â”‚               â”œâ”€â”€ Button (Save)
    â”‚               â”œâ”€â”€ Button (Edit)
    â”‚               â”œâ”€â”€ Button (Export PDF)
    â”‚               â””â”€â”€ Button (Export DOCX)
    â”‚
    â”œâ”€â”€ ReportsPage (/reports)
    â”‚   â”œâ”€â”€ ReportFilters
    â”‚   â”‚   â”œâ”€â”€ SearchInput
    â”‚   â”‚   â”œâ”€â”€ DateRangePicker
    â”‚   â”‚   â”œâ”€â”€ Select (Scan Type)
    â”‚   â”‚   â””â”€â”€ Select (Status)
    â”‚   â”œâ”€â”€ ReportList
    â”‚   â”‚   â””â”€â”€ ReportCard[]
    â”‚   â”‚       â”œâ”€â”€ Badge (Scan Type)
    â”‚   â”‚       â”œâ”€â”€ Text (Clinical History)
    â”‚   â”‚       â”œâ”€â”€ Date
    â”‚   â”‚       â””â”€â”€ Actions
    â”‚   â”‚           â”œâ”€â”€ Button (View)
    â”‚   â”‚           â”œâ”€â”€ Button (Edit)
    â”‚   â”‚           â””â”€â”€ Button (Delete)
    â”‚   â””â”€â”€ Pagination
    â”‚
    â”œâ”€â”€ ReportDetailPage (/reports/[id])
    â”‚   â”œâ”€â”€ ReportHeader
    â”‚   â”‚   â”œâ”€â”€ Title (Scan Type)
    â”‚   â”‚   â”œâ”€â”€ Metadata (Date, Model, Time)
    â”‚   â”‚   â””â”€â”€ Actions
    â”‚   â”‚       â”œâ”€â”€ Button (Edit)
    â”‚   â”‚       â”œâ”€â”€ Button (Export)
    â”‚   â”‚       â””â”€â”€ Button (Delete)
    â”‚   â””â”€â”€ ReportContent
    â”‚       â””â”€â”€ (Same sections as ReportPreview)
    â”‚
    â””â”€â”€ TemplatesPage (/templates)
        â”œâ”€â”€ TemplateFilters
        â”‚   â”œâ”€â”€ SearchInput
        â”‚   â”œâ”€â”€ Select (Modality)
        â”‚   â””â”€â”€ Select (Body Part)
        â”œâ”€â”€ TemplateGrid
        â”‚   â””â”€â”€ TemplateCard[]
        â”‚       â”œâ”€â”€ Badge (Modality)
        â”‚       â”œâ”€â”€ Badge (Body Part)
        â”‚       â”œâ”€â”€ Badge (Default)
        â”‚       â”œâ”€â”€ Text (Description)
        â”‚       â””â”€â”€ Actions
        â”‚           â”œâ”€â”€ Button (Use)
        â”‚           â”œâ”€â”€ Button (Edit)
        â”‚           â””â”€â”€ Button (Delete)
        â””â”€â”€ CreateButton (FAB)
```

---

## ğŸ”„ State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STATE MANAGEMENT                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT STATE (React Context + Hooks)
â”‚
â”œâ”€â”€ AuthContext
â”‚   â”œâ”€â”€ State:
â”‚   â”‚   â”œâ”€â”€ user: User | null
â”‚   â”‚   â”œâ”€â”€ isAuthenticated: boolean
â”‚   â”‚   â”œâ”€â”€ isLoading: boolean
â”‚   â”‚   â””â”€â”€ error: string | null
â”‚   â””â”€â”€ Actions:
â”‚       â”œâ”€â”€ login(credentials) â†’ Promise<void>
â”‚       â”œâ”€â”€ logout() â†’ Promise<void>
â”‚       â””â”€â”€ refreshSession() â†’ Promise<void>
â”‚
â”œâ”€â”€ ThemeContext
â”‚   â”œâ”€â”€ State:
â”‚   â”‚   â””â”€â”€ theme: 'light' | 'dark' | 'system'
â”‚   â””â”€â”€ Actions:
â”‚       â””â”€â”€ setTheme(theme) â†’ void
â”‚
â””â”€â”€ ToastContext
    â”œâ”€â”€ State:
    â”‚   â””â”€â”€ toasts: Toast[]
    â””â”€â”€ Actions:
        â”œâ”€â”€ toast(message, type) â†’ void
        â””â”€â”€ dismiss(id) â†’ void

SERVER STATE (React Query / SWR)
â”‚
â”œâ”€â”€ Templates
â”‚   â”œâ”€â”€ useTemplates(filters)
â”‚   â”‚   â”œâ”€â”€ Query Key: ['templates', userId, filters]
â”‚   â”‚   â”œâ”€â”€ Fetcher: GET /api/templates
â”‚   â”‚   â”œâ”€â”€ Cache: 5 minutes
â”‚   â”‚   â””â”€â”€ Refetch: On window focus
â”‚   â”‚
â”‚   â”œâ”€â”€ useTemplate(id)
â”‚   â”‚   â”œâ”€â”€ Query Key: ['template', id]
â”‚   â”‚   â”œâ”€â”€ Fetcher: GET /api/templates/:id
â”‚   â”‚   â””â”€â”€ Cache: 10 minutes
â”‚   â”‚
â”‚   â”œâ”€â”€ useCreateTemplate()
â”‚   â”‚   â”œâ”€â”€ Mutation: POST /api/templates
â”‚   â”‚   â””â”€â”€ Invalidates: ['templates']
â”‚   â”‚
â”‚   â””â”€â”€ useUpdateTemplate()
â”‚       â”œâ”€â”€ Mutation: PUT /api/templates/:id
â”‚       â””â”€â”€ Invalidates: ['templates'], ['template', id]
â”‚
â”œâ”€â”€ Reports
â”‚   â”œâ”€â”€ useReports(filters)
â”‚   â”‚   â”œâ”€â”€ Query Key: ['reports', userId, filters]
â”‚   â”‚   â”œâ”€â”€ Fetcher: GET /api/reports
â”‚   â”‚   â”œâ”€â”€ Cache: 2 minutes
â”‚   â”‚   â””â”€â”€ Pagination: Enabled
â”‚   â”‚
â”‚   â”œâ”€â”€ useReport(id)
â”‚   â”‚   â”œâ”€â”€ Query Key: ['report', id]
â”‚   â”‚   â””â”€â”€ Fetcher: GET /api/reports/:id
â”‚   â”‚
â”‚   â””â”€â”€ useGenerateReport()
â”‚       â”œâ”€â”€ Mutation: POST /api/generate
â”‚       â”œâ”€â”€ On Success: Invalidates ['reports']
â”‚       â””â”€â”€ Optimistic Update: Add pending report
â”‚
â””â”€â”€ Transcription
    â”œâ”€â”€ useTranscription()
    â”‚   â”œâ”€â”€ Mutation: POST /api/transcribe
    â”‚   â””â”€â”€ Progress: Track upload progress
    â”‚
    â””â”€â”€ useRealtimeTranscription()
        â”œâ”€â”€ WebSocket: /api/transcribe/ws
        â”œâ”€â”€ State: transcript, isRecording, confidence
        â””â”€â”€ Actions: start(), stop(), pause()

LOCAL STATE (Component State)
â”‚
â”œâ”€â”€ Form State (React Hook Form)
â”‚   â”œâ”€â”€ ReportForm
â”‚   â”‚   â”œâ”€â”€ scan_type: string
â”‚   â”‚   â”œâ”€â”€ clinical_history: string
â”‚   â”‚   â”œâ”€â”€ findings: string
â”‚   â”‚   â”œâ”€â”€ comparison: string
â”‚   â”‚   â”œâ”€â”€ template_id: string
â”‚   â”‚   â””â”€â”€ options: GenerationOptions
â”‚   â”‚
â”‚   â””â”€â”€ TemplateForm
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ content: string
â”‚       â”œâ”€â”€ description: string
â”‚       â”œâ”€â”€ modality: string
â”‚       â”œâ”€â”€ body_part: string
â”‚       â””â”€â”€ tags: string[]
â”‚
â””â”€â”€ UI State
    â”œâ”€â”€ Modals: isOpen, activeModal
    â”œâ”€â”€ Dropdowns: isExpanded
    â”œâ”€â”€ Sidebars: isCollapsed
    â””â”€â”€ Filters: activeFilters
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SECURITY LAYERS                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LAYER 1: NETWORK SECURITY
â”œâ”€â”€ HTTPS Only (TLS 1.3)
â”œâ”€â”€ Content Security Policy (CSP)
â”œâ”€â”€ HSTS Headers
â””â”€â”€ DDoS Protection (Vercel)

LAYER 2: AUTHENTICATION
â”œâ”€â”€ Outseta OAuth 2.0
â”‚   â”œâ”€â”€ Authorization Code Flow
â”‚   â”œâ”€â”€ PKCE (optional, recommended)
â”‚   â”œâ”€â”€ State Parameter (CSRF protection)
â”‚   â””â”€â”€ Token Expiration (7 days)
â”œâ”€â”€ Session Management
â”‚   â”œâ”€â”€ HTTP-Only Cookies
â”‚   â”œâ”€â”€ Secure Flag (production)
â”‚   â”œâ”€â”€ SameSite=Lax
â”‚   â””â”€â”€ Token Refresh
â””â”€â”€ Multi-Factor Authentication (Outseta)

LAYER 3: AUTHORIZATION
â”œâ”€â”€ Middleware Protection
â”‚   â”œâ”€â”€ Check: Session token valid
â”‚   â”œâ”€â”€ Verify: With Outseta API
â”‚   â””â”€â”€ Block: Unauthorized requests
â”œâ”€â”€ API Route Guards
â”‚   â”œâ”€â”€ Extract: User ID from token
â”‚   â”œâ”€â”€ Validate: User exists
â”‚   â””â”€â”€ Check: Subscription status
â””â”€â”€ Row Level Security (RLS)
    â”œâ”€â”€ Policy: Users see only their data
    â”œâ”€â”€ Enforcement: Database level
    â””â”€â”€ Bypass: Service role key only

LAYER 4: DATA PROTECTION
â”œâ”€â”€ Encryption at Rest
â”‚   â”œâ”€â”€ Database: Supabase default
â”‚   â””â”€â”€ Files: Supabase Storage
â”œâ”€â”€ Encryption in Transit
â”‚   â”œâ”€â”€ HTTPS: All connections
â”‚   â””â”€â”€ WSS: WebSocket connections
â””â”€â”€ Sensitive Data Handling
    â”œâ”€â”€ No PHI in logs
    â”œâ”€â”€ Masked in error messages
    â””â”€â”€ Audit trail for access

LAYER 5: INPUT VALIDATION
â”œâ”€â”€ Client-Side
â”‚   â”œâ”€â”€ React Hook Form
â”‚   â”œâ”€â”€ Zod Schemas
â”‚   â””â”€â”€ Real-time validation
â”œâ”€â”€ Server-Side
â”‚   â”œâ”€â”€ API Route validation
â”‚   â”œâ”€â”€ Zod Schema parsing
â”‚   â””â”€â”€ Type checking
â””â”€â”€ Sanitization
    â”œâ”€â”€ XSS Prevention
    â”œâ”€â”€ SQL Injection (Supabase parameterized)
    â””â”€â”€ Path Traversal

LAYER 6: API SECURITY
â”œâ”€â”€ Rate Limiting
â”‚   â”œâ”€â”€ Per User: 60 req/min
â”‚   â”œâ”€â”€ Per IP: 100 req/min
â”‚   â””â”€â”€ Sliding Window
â”œâ”€â”€ CORS Policy
â”‚   â”œâ”€â”€ Origin: Same domain only
â”‚   â”œâ”€â”€ Credentials: Include
â”‚   â””â”€â”€ Methods: Explicit list
â””â”€â”€ API Keys
    â”œâ”€â”€ Environment variables
    â”œâ”€â”€ Never in code
    â””â”€â”€ Rotation policy

LAYER 7: MONITORING & INCIDENT RESPONSE
â”œâ”€â”€ Error Tracking (Sentry)
â”‚   â”œâ”€â”€ Client errors
â”‚   â”œâ”€â”€ Server errors
â”‚   â””â”€â”€ Performance issues
â”œâ”€â”€ Audit Logging
â”‚   â”œâ”€â”€ Authentication events
â”‚   â”œâ”€â”€ Data access
â”‚   â””â”€â”€ Admin actions
â””â”€â”€ Alerts
    â”œâ”€â”€ Suspicious activity
    â”œâ”€â”€ Failed auth attempts
    â””â”€â”€ API anomalies
```

---

## ğŸ“Š Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEPLOYMENT ARCHITECTURE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEVELOPMENT ENVIRONMENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Developer Machine        â”‚
â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  localhost:3000    â”‚   â”‚
â”‚   â”‚  Next.js Dev       â”‚   â”‚
â”‚   â”‚  Hot Reload        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚               â”‚
â”‚            â–¼               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Local Supabase    â”‚   â”‚
â”‚   â”‚  (Docker)          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STAGING/PREVIEW ENVIRONMENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Vercel Preview        â”‚
â”‚  (per Pull Request)        â”‚
â”‚                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  preview-*.vercel  â”‚   â”‚
â”‚   â”‚  Next.js Build     â”‚   â”‚
â”‚   â”‚  Edge Functions    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                 â”‚
â”‚          â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Preview Database  â”‚   â”‚
â”‚   â”‚  (Supabase Branch) â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRODUCTION ENVIRONMENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VERCEL EDGE NETWORK                                  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   US East   â”‚  â”‚   US West   â”‚  â”‚   Europe    â”‚  â”‚   Asia Pac  â”‚       â”‚
â”‚  â”‚   (IAD)     â”‚  â”‚   (SFO)     â”‚  â”‚   (FRA)     â”‚  â”‚   (SIN)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                â”‚                 â”‚                 â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                     â”‚   Next.js App        â”‚                                â”‚
â”‚                     â”‚   â€¢ Server Comp      â”‚                                â”‚
â”‚                     â”‚   â€¢ API Routes       â”‚                                â”‚
â”‚                     â”‚   â€¢ Edge Functions   â”‚                                â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                â”‚                â”‚
                â–¼                â–¼                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Supabase    â”‚  â”‚  Outseta    â”‚  â”‚  OpenAI      â”‚
     â”‚  Production  â”‚  â”‚  Production â”‚  â”‚  API         â”‚
     â”‚              â”‚  â”‚             â”‚  â”‚              â”‚
     â”‚  â€¢ Database  â”‚  â”‚  â€¢ Auth     â”‚  â”‚  â€¢ GPT-5/O3  â”‚
     â”‚  â€¢ Storage   â”‚  â”‚  â€¢ Billing  â”‚  â”‚  â€¢ Whisper   â”‚
     â”‚  â€¢ Realtime  â”‚  â”‚  â€¢ CRM      â”‚  â”‚  â€¢ ChatKit   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CI/CD PIPELINE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GITHUB ACTIONS                                       â”‚
â”‚                                                                               â”‚
â”‚  1. Push to Branch                                                           â”‚
â”‚     â””â”€â”€> Trigger Workflow                                                    â”‚
â”‚                                                                               â”‚
â”‚  2. Lint & Type Check                                                        â”‚
â”‚     â”œâ”€â”€> ESLint                                                              â”‚
â”‚     â””â”€â”€> TypeScript                                                          â”‚
â”‚                                                                               â”‚
â”‚  3. Run Tests                                                                â”‚
â”‚     â”œâ”€â”€> Unit Tests (Vitest)                                                 â”‚
â”‚     â”œâ”€â”€> Integration Tests                                                   â”‚
â”‚     â””â”€â”€> Coverage Report                                                     â”‚
â”‚                                                                               â”‚
â”‚  4. Build Application                                                        â”‚
â”‚     â”œâ”€â”€> Next.js Build                                                       â”‚
â”‚     â”œâ”€â”€> Type Generation                                                     â”‚
â”‚     â””â”€â”€> Asset Optimization                                                  â”‚
â”‚                                                                               â”‚
â”‚  5. Deploy to Vercel                                                         â”‚
â”‚     â”œâ”€â”€> Preview (on PR)                                                     â”‚
â”‚     â””â”€â”€> Production (on main)                                                â”‚
â”‚                                                                               â”‚
â”‚  6. Post-Deploy                                                              â”‚
â”‚     â”œâ”€â”€> Smoke Tests                                                         â”‚
â”‚     â”œâ”€â”€> Database Migrations                                                 â”‚
â”‚     â””â”€â”€> Notification (Slack/Email)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Microservices Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICE INTERACTION MAP                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Next.js App
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
     â–¼                 â–¼
Supabase          Outseta
     â”‚                 â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚  â”‚              â”‚
     â”‚  â”‚  User Sync   â”‚
     â”‚  â”‚  (Webhook)   â”‚
     â”‚  â”‚              â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database Operations           â”‚
â”‚   â€¢ CRUD on all tables          â”‚
â”‚   â€¢ File storage (Supabase)     â”‚
â”‚   â€¢ Realtime subscriptions      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Next.js App â†’ OpenAI
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Whisper API
     â”‚            â€¢ Audio â†’ Text
     â”‚            â€¢ Streaming mode
     â”‚            â€¢ Batch mode
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GPT-5 / O3
     â”‚            â€¢ Report generation
     â”‚            â€¢ Fallback to GPT-4o
     â”‚            â€¢ JSON mode
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ChatKit
                  â€¢ Widget rendering
                  â€¢ Custom actions
                  â€¢ Context management

Next.js App â†’ Search Services
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PubMed
     â”‚            â€¢ Medical literature
     â”‚            â€¢ E-utilities API
     â”‚            â€¢ Result ranking
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Radiopaedia
     â”‚            â€¢ Radiology reference
     â”‚            â€¢ Case studies
     â”‚            â€¢ Image database
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Google Custom Search
                  â€¢ General web search
                  â€¢ Filtered results
                  â€¢ Medical sites only

Webhooks (Inbound)
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Outseta Webhooks
                  â€¢ subscription.created
                  â€¢ subscription.updated
                  â€¢ subscription.canceled
                  â€¢ user.updated
                  â”‚
                  â””â”€â”€â–º Sync to Supabase
```

---

*These diagrams provide visual representations of the system architecture, data flows, and component relationships. Use them as reference during development and for onboarding new team members.*

**Legend**:
- `â”€â”€â”€â”€â”€` : Flow/Connection
- `â”‚` : Vertical connection
- `â”Œâ”â””â”˜` : Boxes/containers
- `â–¼â–º` : Direction of flow
- `â—„` : Foreign key relationship
- `PK` : Primary Key
- `FK` : Foreign Key
